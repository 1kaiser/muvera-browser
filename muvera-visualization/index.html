<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MuVeRa FDE Construction</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600&display=swap');
      
      body {
        font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin: 0;
        padding: 40px;
        background: #fafafa;
        color: #333;
      }
      
      .animation-container {
        width: 100%;
        margin: 0 0 40px 0;
        background: white;
        padding: 20px;
        border: 2px solid #e0e0e0;
      }
      
      .main-visualization {
        display: flex;
        gap: 40px;
        align-items: flex-start;
      }
      
      .semantic-space {
        flex: 1;
      }
      
      .fde-panel {
        flex: 1;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        padding: 20px;
      }
      
      .fde-panel h3 {
        margin: 0 0 20px 0;
        font-size: 18px;
        font-weight: 500;
        font-family: 'Google Sans', sans-serif;
      }
      
      #animation-title, #animation-title-doc {
        font-size: 24px;
        font-weight: 400;
        font-family: 'Google Sans', sans-serif;
        text-align: center;
        margin: 0 0 30px 0;
        color: #333;
      }
      
      #semantic-svg, #semantic-svg-doc {
        width: 400px;
        height: 400px;
        background: white;
        border: 2px solid #e0e0e0;
      }
      
      #fde-svg, #fde-svg-doc {
        width: 100%;
        height: 250px;
        background: white;
      }
      
      .query-text {
        margin-top: 20px;
        padding: 15px;
        background: #f5f5f5;
        border: 1px solid #ddd;
        font-size: 16px;
        font-weight: 500;
        text-align: center;
        min-height: 20px;
      }
      
      .bottom-panel {
        margin-top: 20px;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        padding: 20px;
        height: 120px;
      }
      
      #bottom-svg, #bottom-svg-doc {
        width: 100%;
        height: 80px;
        background: white;
      }
      
      .pause-overlay {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #333;
        color: white;
        padding: 10px 20px;
        border: 2px solid #555;
        font-size: 14px;
        cursor: pointer;
        z-index: 1000;
      }

      .input-controls {
        width: 100%;
        margin: 0 0 20px 0;
        background: white;
        padding: 20px;
        border: 2px solid #e0e0e0;
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-family: 'Google Sans', sans-serif;
      }

      .input-group input, .input-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        font-family: 'Google Sans', sans-serif;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .input-group input:focus, .input-group textarea:focus {
        outline: none;
        border-color: #4285f4;
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .control-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
      }

      .btn {
        padding: 12px 24px;
        border: 2px solid transparent;
        font-family: 'Google Sans', sans-serif;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #4285f4;
        color: white;
        border-color: #4285f4;
      }

      .btn-primary:hover {
        background: #3367d6;
        border-color: #3367d6;
      }

      .btn-secondary {
        background: #f8f9fa;
        color: #333;
        border-color: #dadce0;
      }

      .btn-secondary:hover {
        background: #e8eaed;
        border-color: #bbb;
      }

      /* Side-by-side layout styles */
      .side-by-side-container {
        display: flex;
        gap: 30px;
        align-items: flex-start;
        margin-bottom: 30px;
      }

      .processing-side {
        flex: 1;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        position: relative;
      }

      .processing-title {
        margin: 0 0 20px 0;
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        color: #333;
        font-family: 'Google Sans', sans-serif;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 10px;
      }

      .processing-visualization {
        display: flex;
        gap: 20px;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .processing-side .semantic-space {
        flex: 1.2;
      }

      .processing-side .fde-panel {
        flex: 0.8;
        background: white;
        border: 1px solid #dadce0;
        border-radius: 4px;
        padding: 15px;
      }

      .processing-side .fde-panel h3 {
        margin: 0 0 15px 0;
        font-size: 14px;
        font-weight: 500;
        color: #666;
      }

      .processing-side .bottom-panel {
        background: white;
        border: 1px solid #dadce0;
        border-radius: 4px;
        padding: 15px;
        min-height: 60px;
      }

      /* Comparison panel styles */
      .comparison-panel {
        background: #e3f2fd;
        border: 2px solid #2196f3;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .comparison-panel h3 {
        margin: 0 0 15px 0;
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        color: #1976d2;
      }

      .comparison-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .stat-item {
        background: white;
        padding: 12px;
        border-radius: 4px;
        border: 1px solid #bbdefb;
        font-size: 14px;
      }

      .stat-item strong {
        color: #1976d2;
      }

      /* Mathematical Calculations Section */
      .calculations-section {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .calculations-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 25px;
      }

      .calculation-panel {
        background: white;
        border: 2px solid #dadce0;
        border-radius: 6px;
        padding: 20px;
      }

      .calculation-panel h3 {
        margin: 0 0 15px 0;
        font-size: 16px;
        font-weight: 600;
        color: #333;
        font-family: 'Google Sans', sans-serif;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 8px;
      }

      .calc-stage {
        margin-bottom: 15px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 4px;
        border-left: 4px solid #4285f4;
      }

      .calc-stage h4 {
        margin: 0 0 8px 0;
        font-size: 14px;
        font-weight: 500;
        color: #4285f4;
        font-family: 'Google Sans', sans-serif;
      }

      .math-display {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        background: white;
        padding: 10px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        line-height: 1.4;
        color: #333;
        white-space: pre-wrap;
      }

      .similarity-calculation {
        background: #e3f2fd;
        border: 2px solid #2196f3;
        border-radius: 6px;
        padding: 20px;
        text-align: center;
      }

      .similarity-calculation h3 {
        margin: 0 0 15px 0;
        font-size: 18px;
        font-weight: 600;
        color: #1976d2;
        font-family: 'Google Sans', sans-serif;
      }

      .similarity-calculation .math-display {
        font-size: 16px;
        font-weight: 500;
        background: white;
        border: 2px solid #bbdefb;
      }

      #final-similarity {
        color: #d32f2f;
        font-weight: bold;
        font-size: 18px;
      }

      /* Collapsible calculations header */
      #calculations-header:hover {
        background-color: #f5f5f5;
        border-radius: 4px;
        padding: 8px;
      }

      #calculations-toggle {
        font-size: 16px;
        margin-left: 8px;
        transition: transform 0.2s ease;
      }

      /* Responsive design */
      @media (max-width: 1200px) {
        .side-by-side-container {
          flex-direction: column;
        }
        
        .comparison-stats {
          grid-template-columns: 1fr;
        }
        
        .calculations-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Input Controls Section -->
    <div class="input-controls">
      <h2 style="text-align: center; margin: 0 0 25px 0; color: #333; font-family: 'Google Sans', sans-serif;">
        üîç MuVeRa FDE Algorithm - Interactive Text Input
      </h2>
      
      <div class="input-row">
        <div class="input-group">
          <label for="query-input">Query Text:</label>
          <input 
            type="text" 
            id="query-input" 
            placeholder="What is the height of Mount Everest?"
            value="What is the height of Mount Everest?"
          />
        </div>
        
        <div class="input-group">
          <label for="document-input">Document Text:</label>
          <input 
            type="text" 
            id="document-input" 
            placeholder="Mount Everest is 8,848 meters high."
            value="Mount Everest is 8,848 meters high."
          />
        </div>
      </div>
      
      <div class="input-group">
        <label for="embedding-method">Embedding Method:</label>
        <select id="embedding-method" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; font-family: 'Google Sans', sans-serif; font-size: 14px;">
          <option value="hash">Hash-based (Fast, Demo)</option>
          <option value="gemma" selected>EmbeddingGemma (Semantic, High Quality)</option>
        </select>
        <div id="embedding-status" style="margin-top: 8px; font-size: 12px; color: #f57c00; font-style: italic;">
          Loading EmbeddingGemma model...
        </div>
      </div>
      
      <div class="control-buttons">
        <button class="btn btn-primary" id="process-btn">
          üöÄ Process New Texts
        </button>
        <button class="btn btn-secondary" id="reset-btn">
          üîÑ Reset to Defaults
        </button>
        <button class="btn btn-secondary" id="random-btn">
          üé≤ Try Random Examples
        </button>
      </div>
    </div>

    <!-- Side-by-Side Query & Document Animation Section -->
    <div class="animation-container">
      <h1 style="text-align: center; margin-bottom: 30px;">MuVeRa FDE Construction - Query vs Document</h1>
      
      <!-- Mathematical Calculations Section -->
      <div class="calculations-section">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333; font-family: 'Google Sans', sans-serif; cursor: pointer; user-select: none;" id="calculations-header" onclick="toggleCalculations()">
          üßÆ Live Mathematical Calculations <span id="calculations-toggle">‚ñº</span>
        </h2>
        
        <div class="calculations-grid" id="calculations-content" style="display: none;">
          <!-- Query Calculations -->
          <div class="calculation-panel">
            <h3>üìä Query Processing (SUM Aggregation)</h3>
            <div id="query-calculations">
              <div class="calc-stage">
                <h4>Step 1: SimHash Projections</h4>
                <div id="query-simhash-calcs" class="math-display">Loading...</div>
              </div>
              <div class="calc-stage">
                <h4>Step 2: Partition Assignment</h4>
                <div id="query-partition-calcs" class="math-display">Loading...</div>
              </div>
              <div class="calc-stage">
                <h4>Step 3: Vector Aggregation (SUM)</h4>
                <div id="query-aggregation-calcs" class="math-display">Loading...</div>
              </div>
            </div>
          </div>
          
          <!-- Document Calculations -->
          <div class="calculation-panel">
            <h3>üìà Document Processing (AVERAGE Aggregation)</h3>
            <div id="document-calculations">
              <div class="calc-stage">
                <h4>Step 1: SimHash Projections</h4>
                <div id="doc-simhash-calcs" class="math-display">Loading...</div>
              </div>
              <div class="calc-stage">
                <h4>Step 2: Partition Assignment</h4>
                <div id="doc-partition-calcs" class="math-display">Loading...</div>
              </div>
              <div class="calc-stage">
                <h4>Step 3: Vector Aggregation (AVERAGE)</h4>
                <div id="doc-aggregation-calcs" class="math-display">Loading...</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Final Similarity Calculation -->
        <div class="similarity-calculation">
          <h3>üéØ Final Similarity Computation</h3>
          <div id="similarity-calculation" class="math-display">
            Similarity = Query_FDE ¬∑ Document_FDE = <span id="final-similarity">0.000</span>
          </div>
        </div>
      </div>
      
      <!-- Side-by-side layout -->
      <div class="side-by-side-container">
        
        <!-- Query Processing (Left Side) -->
        <div class="processing-side">
          <h2 id="animation-title" class="processing-title">üîç Query FDE Construction</h2>
          
          <div class="processing-visualization">
            <div class="semantic-space">
              <svg id="semantic-svg"></svg>
              <div class="query-text" id="query-text"></div>
            </div>
            
            <div class="fde-panel">
              <h3>Semantic Space Dimension</h3>
              <svg id="fde-svg"></svg>
            </div>
          </div>
          
          <div class="bottom-panel">
            <svg id="bottom-svg"></svg>
          </div>
        </div>
        
        <!-- Document Processing (Right Side) -->
        <div class="processing-side">
          <h2 id="animation-title-doc" class="processing-title">üìÑ Document FDE Construction</h2>
          
          <div class="processing-visualization">
            <div class="semantic-space">
              <svg id="semantic-svg-doc"></svg>
              <div class="query-text" id="query-text-doc"></div>
            </div>
            
            <div class="fde-panel">
              <h3>Semantic Space Dimension</h3>
              <svg id="fde-svg-doc"></svg>
            </div>
          </div>
          
          <div class="bottom-panel">
            <svg id="bottom-svg-doc"></svg>
          </div>
        </div>
        
      </div>
      
      <!-- Comparison Panel -->
      <div class="comparison-panel">
        <h3>üéØ Live Comparison</h3>
        <div class="comparison-stats" id="comparison-stats">
          <div class="stat-item">
            <strong>Query Method:</strong> <span id="query-method">SUM aggregation</span>
          </div>
          <div class="stat-item">
            <strong>Document Method:</strong> <span id="doc-method">AVERAGE aggregation</span>
          </div>
          <div class="stat-item">
            <strong>Hyperplane Angles:</strong> <span id="hyperplane-diff">Different random partitions</span>
          </div>
          <div class="stat-item">
            <strong>Similarity Score:</strong> <span id="similarity-score">Computing...</span>
          </div>
        </div>
      </div>
      
    </div>

    <!-- Document Collection & Search Section -->
    <div class="input-controls">
      <h2 style="text-align: center; margin: 0 0 25px 0; color: #333; font-family: 'Google Sans', sans-serif;">
        üìö Document Collection Search
      </h2>
      
      <div class="input-row">
        <div class="input-group">
          <label for="collection-select">Sample Collection:</label>
          <select id="collection-select" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; font-family: 'Google Sans', sans-serif; font-size: 14px;">
            <option value="">Choose a collection...</option>
            <option value="academic">Academic Papers (AI/ML)</option>
            <option value="literature">Literature & Writing</option>
            <option value="cooking">Cooking & Recipes</option>
          </select>
        </div>
        
        <div class="input-group">
          <label for="search-query">Search Query:</label>
          <input 
            type="text" 
            id="search-query" 
            placeholder="machine learning algorithms"
            disabled
          />
        </div>
      </div>
      
      <div class="control-buttons">
        <button class="btn btn-primary" id="load-collection-btn">
          üìö Load Collection
        </button>
        <button class="btn btn-primary" id="index-documents-btn" disabled>
          üîÑ Index Documents
        </button>
        <button class="btn btn-primary" id="search-btn" disabled>
          üîç Search Documents
        </button>
      </div>
      
      <div id="collection-status" style="margin-top: 15px; padding: 12px; background: #f8f9fa; border: 2px solid #e9ecef; font-size: 14px; text-align: center; color: #666;">
        Ready to load a document collection...
      </div>
    </div>

    <!-- Search Results Section -->
    <div class="input-controls" id="search-results-section" style="display: none;">
      <h2 style="text-align: center; margin: 0 0 25px 0; color: #333; font-family: 'Google Sans', sans-serif;">
        üéØ Search Results
      </h2>
      <div id="search-results"></div>
    </div>
    
    <div class="pause-overlay" id="pause-btn">‚è∏</div>
    
    <script>
      function toggleCalculations() {
        const content = document.getElementById('calculations-content');
        const toggle = document.getElementById('calculations-toggle');
        
        if (content.style.display === 'none') {
          content.style.display = 'grid';
          toggle.textContent = '‚ñ≤';
        } else {
          content.style.display = 'none';
          toggle.textContent = '‚ñº';
        }
      }
    </script>
    
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
